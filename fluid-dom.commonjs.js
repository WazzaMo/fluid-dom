//  Fluid-DOM v 1.2.0
"use strict";function providesAll(e,t){var r="";for(var s of e){null!=t[s]||(r+=`Value for ${s} was not provided.\n`)}return!r||(console.error(`Expected ${e.length} parameters:\n${r}`),!1)}Object.defineProperty(exports,"__esModule",{value:!0});class Option{constructor(e){this.value=e||null}get Value(){return this.value}get isValid(){return!!this.value}}class DomAttributes{constructor(e){this._webElement=e}each(e){for(var t of this._webElement.attributes)e(t.name,t.value);return this}attributeNames(){var e=new Array;for(var t of this._webElement.attributes)e.push(t.name);return e}add(e,t){return this.set(e,t)}set(e,t){return this._webElement.setAttribute(e,t),this}with(e,t){return t(this.get(e)),this}get(e){return this._webElement.getAttribute(e)}has(e){return null!=this._webElement.getAttribute(e)}remove(e){return this._webElement.removeAttribute(e),this}}class DomClasses{constructor(e,t){this.element=t,this.htmlElement=e}each(e){for(var t of this.htmlElement.classList)e(t);return this}has(e){return this.htmlElement.classList.contains(e)}whenHas(e,t){return this.has(e)&&t(this.element),this}add(e){if(e&&e.length>0){if(!this.htmlElement)throw Error("Can't edit classes on DomElement that provides no HTMLElement.");this.htmlElement.classList.add(e)}else console.error(`Class name given was "${e}" - it must not be empty!`);return this}remove(e){return this.htmlElement.classList.remove(e),this}set(e){return this.has(e)||this.add(e),this}}class NonClasses{constructor(){}each(e){return this}has(e){return!1}whenHas(e,t){return this}add(e){return this}remove(e){return this}set(e){return this}}function convertHtmlCollection(e){let t=[];for(var r=0;r<e.length;r++){let s=e[r];t.push(new DomElement(s))}return t}function selectorPath(e){let t="";if(e){t=e.getAttribute("id")?"#{$id}":e.parentElement?`${selectorPath(e.parentElement)}>${e.tagName}`:e.tagName}return t}function getBySelector(e,t){let r=e.querySelector(t);return r||((r=document.querySelector(`${selectorPath(e)}>${t}`))?r:null)}class DomElement{constructor(e){this.domElement=new Option(e)}alertInvalid(){console.error("IElement[DomElement] is invalid.")}static getListFromSelector(e){return convertHtmlCollection(document.querySelectorAll(e))}static getListFromClass(e){return convertHtmlCollection(document.querySelectorAll(`.${e}`))}static getListFromTagName(e){return convertHtmlCollection(document.querySelectorAll(e))}static getElementFromId(e){let t=document.querySelector(`#${e}`);return DomElement.makeFromElement(t)}static getElementFromSelector(e){let t=document.querySelector(e);return DomElement.makeFromElement(t)}static nullElement(){return new DomElement}static makeFromElement(e){return e?new DomElement(e):this.nullElement()}isValid(){return this.domElement.isValid}getParent(){if(this.domElement.isValid){let e,t=this.domElement.Value.parentElement;return e=t?new DomElement(t):new DomElement}return DomElement.nullElement()}withChildren(e){if(this.domElement.isValid&&this.domElement.Value.children.length>0){e(convertHtmlCollection(this.domElement.Value.children))}return this}expect(e){if(this.domElement.isValid){let t=this.domElement.Value.tagName.toUpperCase(),r=e.toUpperCase();t!=r&&console.error(`Expected ${r} but Actual tagName was ${t}`)}else this.alertInvalid();return this}getId(){return this.attributes().get("id")}hasId(){return this.attributes().has("id")}exists(){return this.isValid()}findAll(e){let t=e.selector||e.tagName;if(t){return convertHtmlCollection(this.domElement.Value.querySelectorAll(t))}return[]}selectFirst(e){if(this.domElement.isValid){let t=getBySelector(this.domElement.Value,e);if(t)return new DomElement(t)}return new DomElement}selectorPath(){return this.domElement.isValid?selectorPath(this.domElement.Value):(this.alertInvalid(),"")}tagName(){return this.domElement.isValid?this.domElement.Value.tagName:(this.alertInvalid(),"UNKNOWN")}text(e){if(this.domElement.isValid){let t=this.domElement.Value;return e?(t.innerText=e,this):t.innerText}return this.alertInvalid(),""}html(e){if(this.domElement.isValid){let t=this.domElement.Value;return e?(t.innerHTML=e,this):t.innerHTML}return this.alertInvalid(),""}append(e){var t=`${this.html()}${e}`;return this.html(t),this}prepend(e){var t=`${e}${this.html()}`;return this.html(t),this}remove(){this.domElement.isValid?this.domElement.Value.remove():this.alertInvalid()}attributes(){return new DomAttributes(this.domElement.Value)}classes(){return this.domElement.isValid?new DomClasses(this.domElement.Value,this):new NonClasses}on(e){if(providesAll(["event","handler"],e)&&this.domElement.isValid){var t=e.event,r=e.handler,s=e.keepDefault;this.domElement.Value.addEventListener(t,function(e){s||e.preventDefault(),r(e)})}}value(){if(this.domElement.isValid){let e=this.domElement.Value;if(e.value)return e.value}}}var SourceType,Tag;!function(e){e.FailedToLocate="Failed to locate",e.Id="id",e.Selector="selector",e.Class="class",e.TagName="tagName",e.ConstructedWithElement="from given element",e.ConstructedWithChildren="from given list of children",e.Mock="Mock"}(SourceType||(SourceType={})),function(e){e.Button="BUTTON",e.Div="DIV",e.Input="INPUT",e.Paragraph="P"}(Tag||(Tag={})),function(e){e.CONNECT="CONNECT",e.DELETE="DELETE",e.GET="GET",e.HEAD="HEAD",e.OPTIONS="OPTIONS",e.PATCH="PATCH",e.POST="POST",e.PUT="PUT",e.TRACE="TRACE"}(exports.HttpMethod||(exports.HttpMethod={})),function(e){e.TEXT="text",e.ARRAYBUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json"}(exports.HttpResponseType||(exports.HttpResponseType={})),function(e){e.HTTP="http",e.HTTPS="https",e.FILE="file"}(exports.HttpProtocol||(exports.HttpProtocol={}));class HttpPromise{constructor(e){this.httpObject=e,this.promise=void 0}createPromise(e){this.result=void 0,this.promise=new Promise((t,r)=>{let s=this;e(function(e){s.result=e,t(e)},r)})}isResolved(){return null!=this.result}http(){return this.httpObject}afterResult(e){return this.hasPromise(this.promise)&&this.promise.then(t=>{e(this.httpObject,t)}),this}then(e){return this.hasPromise(this.promise)?this.next(this.promise.then(e)):this}catch(e){return this.hasPromise(this.promise)?this.next(this.promise.catch(e)):this}hasPromise(e){return this.promise instanceof Promise}next(e){let t=new HttpPromise(this.httpObject);return t.promise=e,t}}class Http{constructor(){this.protocol=exports.HttpProtocol.HTTP,this.port=void 0,this.hostname="",this.requestHeaders=[],this.path="",this.method=exports.HttpMethod.GET,this.body=void 0,this.uploadData=void 0,this.responseType=exports.HttpResponseType.TEXT,this.timeoutMS=1e3}host(e,t,r){return this.hostname=t,this.port=r,this.protocol=e,this}header(e,t){return this.requestHeaders.push({name:e,value:t}),this}expectedData(e){return this.responseType=e,this}timeoutAt(e){return this.timeoutMS=e,this}context(e){let t=new Http;return t.protocol=this.protocol,t.port=this.port,t.hostname=this.hostname,t.requestHeaders=(new Array).concat(this.requestHeaders),t.path=this.path,t.method=this.method,t.body=this.body,t.uploadData=this.uploadData,t.responseType=this.responseType,e(t),this}call(e,t,r){this.method=e,this.path=t,this.body="string"==typeof r?r:JSON.stringify(r),this.syncPortAndProtocol();let s=this.port?`:${this.port}`:"",o=`${this.protocol}://${this.hostname}${s}${t}`,n=this.createRequestTo(o),i=this.setHandlers(n);return this.addAnyHeaders(n),n.send(this.body),i}syncPortAndProtocol(){(this.protocol==exports.HttpProtocol.HTTP&&80==this.port||this.protocol==exports.HttpProtocol.HTTPS&&443==this.port||this.protocol==exports.HttpProtocol.FILE)&&(this.port=void 0)}createRequestTo(e){let t=new XMLHttpRequest;return t.timeout=this.timeoutMS,t.open(this.method,e),t}setErrorHandlers(e,t){e.onabort=(()=>{t("Request Aborted")}),e.ontimeout=(()=>{t("Timed out")}),e.onerror=(()=>{t("Error occurred.")})}createResponseObject(e){let t=e.getAllResponseHeaders().split("\r\n").map(e=>{let t=e.split(":");return t&&2==t.length?{name:t[0],value:t[1]}:void 0}).filter(e=>null!=e),r={};for(var s in t){let e=t[s];e&&(r[e.name]=e.value)}return{status:e.status,type:e.responseType,body:e.response,headers:r}}setOnCompleteHandler(e,t,r){e.onreadystatechange=(()=>{4==e.readyState&&(200==e.status?t(this.createResponseObject(e)):r(`Returned HTTP ${e.status}`))})}addAnyHeaders(e){if(this.requestHeaders.length>0)for(var t of this.requestHeaders)e.setRequestHeader(t.name,t.value)}setHandlers(e){let t=new HttpPromise(this);return t.createPromise((t,r)=>{this.setErrorHandlers(e,r),this.setOnCompleteHandler(e,t,r)}),t}}const EVENT_LIST=["abort","afterscriptexecute","animationcancel","animationend","animationiteration","auxclick","beforescriptexecute","blur","change","click","close","contextmenu","dblclick","error","focus","fullscreenchange","fullscreenerror","gotpointercapture","input","keydown","keypress","keyup","load","loadend","loadstart","lostpointercapture","mousedown","mousemove","mouseout","mouseover","mouseup","offline","online","pointercancel","pointerdown","pointerenter","pointerleave","pointermove","pointerout","pointerover","pointerup","reset","resize","scroll","select","selectionchange","selectionchange","selectstart","submit","touchcancel","touchmove","touchstart","transitioncancel","transitionend","visibilitychange","wheel"];function createEventHash(){var e={};for(var t of EVENT_LIST){e[t.toUpperCase()]=t}return e}class DOM{constructor(){this.events=createEventHash()}findElement(e){let t=e.id;if(t)return DomElement.getElementFromId(t);let r=e.selector;return r?DomElement.getElementFromSelector(r):DomElement.nullElement()}findAll(e){let t=e.selector;if(t)return DomElement.getListFromSelector(t);let r=e.class;if(r)return DomElement.getListFromClass(r);let s=e.tagName;return s?DomElement.getListFromTagName(s):[]}buttonOn(e){if(providesAll(["id","event","handler"],e)){var t=e.id;this.findElement({id:t}).expect(Tag.Button).on(e)}}}const Events={};for(var event of EVENT_LIST)Events[event.toUpperCase()]=event;exports.DOM=DOM,exports.Events=Events,exports.Http=Http;

